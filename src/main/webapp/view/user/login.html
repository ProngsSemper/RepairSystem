<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="../../css/login.css" type="text/css">
    <title>广东金融学院后勤报修平台</title>
    <script src="../../js/jquery-1.12.4.js"></script>
<!--    <script src="js/screen/screen.js"></script>-->
    
    <style>
        .super-center{
            margin: 0 auto;
        }
    </style>
    <script src="../../layui/layui.js"></script>
    <script src="../../layui/layui.all.js"></script>
    <link rel="stylesheet" href="../../layui/css/layui.css">

</head>
<body>
    <br><br><br><br>
    <div class="nav super-center">
        <img src="../../img/1.png" alt="" class="left-top">
        <img src="../../img/logo.png" alt="logo" class="logo">
        <div class="line"></div>
        <img src="../../img/name.png" alt="" class="name">
        <img src="../../img/1.png" alt="" class="right-top">
    </div>
    <div class="contant super-center">
        <div class="school">
            <img src="../../img/school1.gif" alt="" class="schoolImg">
            <img src="../../img/title1.png" alt="" class="tit">
        </div>
        <div class="login">
            <div class="loginBox">
                <form action="" method="post">
                    <input type="text" class="inputStyle stuId" name="stuId" placeholder="&nbsp;&nbsp;学号/教工号" id="id">
                    <input type="password" class="inputStyle stuPassword" name="stuPassword" placeholder="&nbsp;&nbsp;密码" id="password"><br>
                    <div class="remember">
                        <!-- 验证码 -->
                        <input type="checkbox" class="square" name="remember"><span class="tit-name">记住密码</span>
                    </div>   
                    <div class="check">
                        <input type="text" placeholder="&nbsp;&nbsp;验证码" class="checkInput" name="checkCode" id="myCode">
                        <a href="javascript:void(0)"  class="linkImg">
                            <img src="/checkCode.png" alt="图片加载失败" class="codeImg" id="vcode" onclick="refreshCode()">
                        </a>
                    </div>         
                    <div class="radio">
                        <input type="radio" name="identity" value="1" class="chose" checked><span class="tit-name" >学生</span>
                    </div>
                    <div class="radio">
                        <input type="radio" name="identity" value="2"  class="chose"><span class="tit-name">管理员</span>
                    </div>
                    <div class="radio">   
                        <input type="radio" name="identity" value="3"  class="chose"><span class="tit-name">工人</span>
                    </div>
                    <input type="button" name="" value="登录" class="Submit" id="login">
                </form>
            </div>
        </div>
    </div>
    <div class="footer super-center">
        <img src="../../img/1.png" alt="" class="left-bottom">
        <img src="../../img/title2.png" alt="" class="tit-under">
        <img src="../../img/1.png" alt="" class="right-bottom">
    </div>

</body>
</html>
<!-- 发送ajax请求 -->
<!-- lyr -->
<script>
    $(document).ready(function () {
        $('#login').click(
            function () {

                const uId = $('#id').val();
                const uPassword = $('#password').val();
                const radio = $("input[name='identity']:checked").val();
                const vcode = $('#myCode').val();

                if (!uId) {

                    layer.msg("请输入账号！", {icon: 3});
                    refreshCode();
                    return;
                }
                if (!uPassword) {

                    layer.msg("请输入密码！", {icon: 3});
                    refreshCode();
                    return;
                }
                if (!vcode) {
                    layer.msg("请填写验证码！", {icon: 3});
                    // alert("请填写验证码！");
                    refreshCode();
                    return;
                }
                layer.msg('正在提交请稍候... ', {icon: 16,time: 7000,shade : [0.5 , '#000' , true]});


                $.ajax({
                    type: "post",
                    url: "/user/login",

                    dataType: "json",
                    data: JSON.stringify({'id':uId,'password':uPassword,'radio':radio,'vcode':vcode}),
                    success: function (ans) {
                        if(ans.code==200)
                        {
                            layer.msg('登录成功', {icon: 1});
                            // alert("登录成功");
                            refreshCode();
                            window.setTimeout("window.location.href='../../welcome.jsp'", 1000);
                        }else {
                            layer.msg('登录失败', {icon: 5});
                            refreshCode();
                        }
                    }
                });


            }
        )
    })
</script>
<script>
    function refreshCode(){
        //1.获取验证码图片对象
        var vcode = document.getElementById("vcode");

        //2.设置其src属性，加时间戳
        vcode.src = "/checkCode.png?time="+new Date().getTime();
    }

</script>